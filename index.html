<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TrustBit - Криптовалютная биржа</title>
    <script src="https://unpkg.com/lightweight-charts@4.1.3/dist/lightweight-charts.standalone.production.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #0d0a1f 100%);
            color: #e6e6e6;
            overflow-x: hidden;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 40px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .logo {
            display: flex;
            align-items: center;
            font-size: 24px;
            font-weight: 600;
            color: #7e6bff;
        }
        .logo svg {
            width: 32px;
            height: 32px;
            margin-right: 10px;
        }
        .nav {
            display: flex;
            gap: 20px;
            align-items: center;
        }
        .nav a {
            color: #e6e6e6;
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            opacity: 0.8;
            transition: opacity 0.3s, color 0.3s;
            cursor: pointer;
        }
        .nav a:hover, .nav a.active {
            opacity: 1;
            color: #7e6bff;
        }
        .user-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .language-selector {
            display: flex;
            gap: 10px;
        }
        .language-selector span {
            cursor: pointer;
            font-size: 14px;
            opacity: 0.7;
            transition: opacity 0.3s;
        }
        .language-selector span:hover {
            opacity: 1;
        }
        .profile-dropdown {
            position: relative;
        }
        .profile-btn {
            background: transparent;
            border: none;
            color: #e6e6e6;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .profile-btn::after {
            content: '▼';
            font-size: 10px;
        }
        .dropdown-menu {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            background: #2e1a47;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            min-width: 150px;
            z-index: 100;
        }
        .dropdown-menu.active {
            display: block;
        }
        .dropdown-menu a {
            display: block;
            padding: 10px 15px;
            color: #e6e6e6;
            text-decoration: none;
            font-size: 14px;
        }
        .dropdown-menu a:hover {
            background: rgba(126, 107, 255, 0.2);
        }
        .login-btn, .register-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
        }
        .login-btn {
            background: transparent;
            color: #e6e6e6;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        .register-btn {
            background: #7e6bff;
            color: #fff;
        }
        .login-btn:hover, .register-btn:hover {
            opacity: 0.9;
        }
        .main-content {
            display: none;
            padding: 40px;
        }
        .main-content.active {
            display: block;
        }
        .hero-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 50px 40px;
            background: url('https://via.placeholder.com/1200x400/1a1a2e/ffffff?text=Market+Background') no-repeat center center;
            background-size: cover;
            min-height: 400px;
            position: relative;
        }
        .hero-text h1 {
            font-size: 48px;
            font-weight: 700;
            margin-bottom: 20px;
            line-height: 1.2;
        }
        .hero-text p {
            font-size: 16px;
            opacity: 0.7;
            max-width: 450px;
            line-height: 1.5;
        }
        .promotions {
            display: flex;
            gap: 20px;
            overflow-x: auto;
            padding: 20px 0;
        }
        .promo-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            min-width: 250px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .promo-card h3 {
            font-size: 24px;
            margin-bottom: 10px;
        }
        .promo-card p {
            font-size: 14px;
            opacity: 0.7;
            margin-bottom: 15px;
        }
        .promo-card .btn-primary {
            background: #7e6bff;
            color: #fff;
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: 500;
            cursor: pointer;
            border: none;
            width: 100%;
            transition: all 0.3s;
        }
        .promo-card .btn-primary:hover {
            background: #5a4bff;
        }
        .news-section {
            margin-top: 40px;
        }
        .news-section h2 {
            font-size: 28px;
            margin-bottom: 20px;
        }
        .news-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-height: 400px;
            overflow-y: auto;
        }
        .news-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 10px;
            display: flex;
            flex-direction: column;
        }
        .news-content h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 5px;
        }
        .news-content p {
            font-size: 14px;
            opacity: 0.7;
            line-height: 1.4;
        }
        .news-content .source {
            font-size: 14px;
            color: #7e6bff;
            margin-top: 5px;
        }
        .portfolio-grid {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        .portfolio-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            flex: 1;
            border: 1px solid rgba(255, 255, 255, 0.1);
            min-width: 200px;
        }
        .portfolio-amount {
            font-size: 24px;
            font-weight: 600;
            margin: 10px 0;
        }
        .portfolio-value {
            font-size: 18px;
            color: #7e6bff;
        }
        .crypto-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            margin: 0 auto 10px;
        }
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }
        .card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .wallet-section {
            text-align: left;
        }
        .wallet-section h2 {
            margin-bottom: 20px;
            color: #7e6bff;
            font-size: 28px;
        }
        .balance {
            font-size: 36px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #43e97b;
        }
        .deposit-form {
            margin-top: 30px;
        }
        .input-group {
            margin-bottom: 20px;
        }
        .input-group label {
            display: block;
            font-size: 14px;
            margin-bottom: 5px;
            font-weight: 500;
        }
        .input-group select, .input-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: #e6e6e6;
            font-size: 14px;
        }
        .input-group input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }
        .wallet-address {
            font-family: monospace;
            font-size: 14px;
            word-break: break-all;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            margin-top: 10px;
        }
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
            width: 100%;
        }
        .btn-primary {
            background: linear-gradient(45deg, #7e6bff 0%, #5a4bff 100%);
            color: #fff;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(126, 107, 255, 0.3);
        }
        .trading-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .crypto-list {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            max-height: 600px;
            overflow-y: auto;
        }
        .crypto-list::-webkit-scrollbar {
            width: 8px;
        }
        .crypto-list::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }
        .crypto-list::-webkit-scrollbar-thumb {
            background: linear-gradient(45deg, #7e6bff, #5a4bff);
            border-radius: 10px;
        }
        .crypto-list::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(45deg, #5a4bff, #7e6bff);
        }
        .crypto-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.3s;
        }
        .crypto-item:hover {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }
        .crypto-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .crypto-price {
            text-align: right;
        }
        .price {
            font-size: 18px;
            font-weight: 600;
        }
        .change {
            font-size: 14px;
        }
        .change.positive {
            color: #43e97b;
        }
        .change.negative {
            color: #f5576c;
        }
        .order-book {
            background: rgba(255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
        }
        .order-book h3 {
            font-size: 18px;
            margin-bottom: 15px;
        }
        .order-book-table {
            width: 100%;
            border-collapse: collapse;
        }
        .order-book-table th, .order-book-table td {
            padding: 8px;
            text-align: right;
            font-size: 14px;
        }
        .order-book-table .buy {
            color: #43e97b;
        }
        .order-book-table .sell {
            color: #f5576c;
        }
        .trading-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .buy-sell-form {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
        }
        .tabs {
            display: flex;
            margin-bottom: 20px;
        }
        .tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.3s;
        }
        .tab.active {
            background: linear-gradient(45deg, #7e6bff 0%, #5a4bff 100%);
        }
        .chart-container {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            flex-grow: 1;
            height: 400px;
        }
        .chart {
            width: 100%;
            height: 100%;
        }
        .timeframe-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        .timeframe-btn {
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: #e6e6e6;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        .timeframe-btn.active {
            background: #7e6bff;
            border-color: #7e6bff;
        }
        .timeframe-btn:hover {
            background: rgba(126, 107, 255, 0.3);
        }
        .transactions-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .transactions-table th,
        .transactions-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .transactions-table th {
            background: rgba(255, 255, 255, 0.1);
            font-weight: 600;
        }
        .status {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
        }
        .status.success {
            background: rgba(67, 233, 123, 0.2);
            color: #43e97b;
        }
        .status.failed {
            background: rgba(245, 87, 108, 0.2);
            color: #f5576c;
        }
        .footer {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px 40px;
            text-align: center;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        .footer a {
            color: #7e6bff;
            text-decoration: none;
            margin: 0 10px;
        }
        .footer a:hover {
            text-decoration: underline;
        }
        .support-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(45deg, #7e6bff, #5a4bff);
            color: #fff;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s, box-shadow 0.3s;
            z-index: 1000;
        }
        .support-button:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(126, 107, 255, 0.5);
        }
        .support-chat {
            position: fixed;
            bottom: 90px;
            right: 20px;
            width: 300px;
            height: 400px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: none;
            flex-direction: column;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            z-index: 1000;
        }
        .support-chat.active {
            display: flex;
        }
        .chat-header {
            background: rgba(126, 107, 255, 0.2);
            padding: 10px;
            border-top-left-radius: 15px;
            border-top-right-radius: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .chat-header h3 {
            font-size: 16px;
            color: #7e6bff;
        }
        .chat-close {
            background: none;
            border: none;
            color: #e6e6e6;
            font-size: 16px;
            cursor: pointer;
        }
        .chat-body {
            flex-grow: 1;
            padding: 10px;
            overflow-y: auto;
        }
        .chat-message {
            margin-bottom: 10px;
            padding: 8px 12px;
            border-radius: 10px;
            font-size: 14px;
            max-width: 80%;
        }
        .chat-message.user {
            background: #7e6bff;
            color: #fff;
            margin-left: auto;
        }
        .chat-message.support {
            background: rgba(255, 255, 255, 0.1);
            color: #e6e6e6;
        }
        .chat-input {
            display: flex;
            padding: 10px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        .chat-input input {
            flex-grow: 1;
            padding: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: #e6e6e6;
            font-size: 14px;
            margin-right: 5px;
        }
        .chat-input button {
            background: #7e6bff;
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 8px 12px;
            cursor: pointer;
        }
        .chat-input button:hover {
            background: #5a4bff;
        }
        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            .trading-section {
                grid-template-columns: 1fr;
            }
            .header {
                flex-direction: column;
                gap: 20px;
            }
            .nav {
                flex-wrap: wrap;
                justify-content: center;
            }
            .hero-section {
                flex-direction: column;
                text-align: center;
            }
            .hero-text h1 {
                font-size: 36px;
            }
            .promotions {
                flex-direction: column;
                align-items: center;
            }
            .promo-card {
                width: 100%;
                max-width: 300px;
            }
            .support-chat {
                width: 90%;
                right: 5%;
            }
            .chart-container {
                height: 300px;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo">
            <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                <rect width="32" height="32" rx="8" fill="url(#gradient)"/>
                <path d="M12 8H20V12H16V24H12V12H8V8H12Z" fill="white"/>
                <defs>
                    <linearGradient id="gradient" x1="0" y1="0" x2="32" y2="32" gradientUnits="userSpaceOnUse">
                        <stop stop-color="#7e6bff"/>
                        <stop offset="1" stop-color="#5a4bff"/>
                    </linearGradient>
                </defs>
            </svg>
            TrustBit
        </div>
        <nav class="nav">
            <a href="#" onclick="showSection('dashboard')" class="active">ГЛАВНАЯ</a>
            <a href="#" onclick="showSection('trading')">ТОРГОВЛЯ</a>
            <a href="#" onclick="showSection('wallet')">КОШЕЛЕК</a>
            <a href="#" onclick="showSection('portfolio')">ПОРТФЕЛЬ</a>
            <a href="#" onclick="showSection('history')">ИСТОРИЯ</a>
        </nav>
        <div class="user-controls">
            <div class="language-selector">
                <span>RU</span>
                <span>EN</span>
            </div>
            <div class="profile-dropdown">
                <button class="profile-btn">Профиль</button>
                <div class="dropdown-menu">
                    <a href="#">Настройки</a>
                    <a href="#">Кошелек</a>
                    <a href="#">Выйти</a>
                </div>
            </div>
            <button class="login-btn">ВХОД</button>
            <button class="register-btn">РЕГИСТРАЦИЯ</button>
        </div>
    </header>
    <div id="dashboard" class="main-content active">
        <div class="hero-section">
            <div class="hero-text">
                <h1>Торгуйте с TrustBit</h1>
                <p>Надежная и безопасная платформа для торговли криптовалютами. Начните свой путь в мир цифровых активов.</p>
            </div>
        </div>
        <div class="promotions">
            <div class="promo-card">
                <h3>0% комиссии</h3>
                <p>Торгуйте без комиссий на спотовом рынке до конца месяца!</p>
                <button class="btn-primary">Узнать больше</button>
            </div>
            <div class="promo-card">
                <h3>Стейкинг</h3>
                <p>Получайте до 8% годовых на стейкинг ETH и USDT.</p>
                <button class="btn-primary">Начать стейкинг</button>
            </div>
            <div class="promo-card">
                <h3>Реферальная программа</h3>
                <p>Приглашайте друзей и получайте 20% от их торговых комиссий.</p>
                <button class="btn-primary">Пригласить друга</button>
            </div>
        </div>
        <div class="news-section">
            <h2>Новости криптовалют</h2>
            <div class="news-list" id="news-list"></div>
        </div>
    </div>
    <div id="trading" class="main-content">
        <div class="trading-section">
            <div class="crypto-list">
                <h3>Криптовалюты</h3>
                <div id="crypto-items"></div>
            </div>
            <div class="trading-panel">
                <div class="buy-sell-form">
                    <h3>Торговля <span id="selected-crypto">BTC</span></h3>
                    <div class="tabs">
                        <div class="tab active" onclick="setTradeMode('buy')">Купить</div>
                        <div class="tab" onclick="setTradeMode('sell')">Продать</div>
                    </div>
                    <div class="input-group">
                        <input type="number" id="trade-amount" placeholder="Сумма ($)">
                    </div>
                    <div class="input-group">
                        <input type="number" id="crypto-amount" placeholder="Количество криптовалюты" readonly>
                    </div>
                    <button class="btn btn-primary" id="trade-btn" onclick="executeTrade()">Купить</button>
                </div>
                <div class="order-book">
                    <h3>Книга ордеров</h3>
                    <table class="order-book-table">
                        <thead>
                            <tr>
                                <th>Цена ($)</th>
                                <th>Количество</th>
                            </tr>
                        </thead>
                        <tbody id="order-book-bids"></tbody>
                        <tbody id="order-book-asks"></tbody>
                    </table>
                </div>
                <div class="chart-container">
                    <h3>График <span id="chart-crypto">BTC</span>/USD</h3>
                    <div class="timeframe-selector">
                        <button class="timeframe-btn" onclick="setTimeframe('1h')">1ч</button>
                        <button class="timeframe-btn" onclick="setTimeframe('4h')">4ч</button>
                        <button class="timeframe-btn active" onclick="setTimeframe('1d')">1д</button>
                    </div>
                    <div id="trading-chart" class="chart"></div>
                </div>
            </div>
        </div>
    </div>
    <div id="wallet" class="main-content">
        <div class="card">
            <div class="wallet-section">
                <h2>Ваш кошелек</h2>
                <div class="balance">$<span id="wallet-balance-page">1000.00</span></div>
                <div class="deposit-form">
                    <h3>Пополнить кошелек</h3>
                    <div class="input-group">
                        <label>Выберите криптовалюту</label>
                        <select id="deposit-crypto">
                            <option value="BTC">Bitcoin (BTC)</option>
                            <option value="ETH">Ethereum (ETH)</option>
                            <option value="USDT">Tether (USDT)</option>
                            <option value="BNB">Binance Coin (BNB)</option>
                            <option value="LTC">Litecoin (LTC)</option>
                            <option value="TON">The Open Network (TON)</option>
                            <option value="XRP">Ripple (XRP)</option>
                            <option value="SOL">Solana (SOL)</option>
                            <option value="USDC">USD Coin (USDC)</option>
                            <option value="DOGE">Dogecoin (DOGE)</option>
                            <option value="TRX">Tron (TRX)</option>
                            <option value="ADA">Cardano (ADA)</option>
                            <option value="WBTC">Wrapped Bitcoin (WBTC)</option>
                            <option value="AVAX">Avalanche (AVAX)</option>
                            <option value="SHIB">Shiba Inu (SHIB)</option>
                            <option value="LINK">Chainlink (LINK)</option>
                            <option value="DOT">Polkadot (DOT)</option>
                            <option value="MATIC">Polygon (MATIC)</option>
                            <option value="BCH">Bitcoin Cash (BCH)</option>
                            <option value="UNI">Uniswap (UNI)</option>
                            <option value="XLM">Stellar (XLM)</option>
                            <option value="VET">VeChain (VET)</option>
                            <option value="ATOM">Cosmos (ATOM)</option>
                            <option value="FIL">Filecoin (FIL)</option>
                            <option value="ALGO">Algorand (ALGO)</option>
                            <option value="NEAR">NEAR Protocol (NEAR)</option>
                            <option value="ICP">Internet Computer (ICP)</option>
                            <option value="APT">Aptos (APT)</option>
                            <option value="ARB">Arbitrum (ARB)</option>
                            <option value="OP">Optimism (OP)</option>
                            <option value="INJ">Injective (INJ)</option>
                            <option value="SUI">Sui (SUI)</option>
                            <option value="XTZ">Tezos (XTZ)</option>
                            <option value="EOS">EOS</option>
                            <option value="HBAR">Hedera (HBAR)</option>
                            <option value="XMR">Monero (XMR)</option>
                            <option value="KSM">Kusama (KSM)</option>
                            <option value="AAVE">Aave (AAVE)</option>
                            <option value="MKR">Maker (MKR)</option>
                            <option value="GRT">The Graph (GRT)</option>
                            <option value="RUNE">THORChain (RUNE)</option>
                            <option value="FTM">Fantom (FTM)</option>
                            <option value="SAND">The Sandbox (SAND)</option>
                            <option value="MANA">Decentraland (MANA)</option>
                            <option value="AXS">Axie Infinity (AXS)</option>
                            <option value="CHZ">Chiliz (CHZ)</option>
                            <option value="CRV">Curve DAO Token (CRV)</option>
                            <option value="COMP">Compound (COMP)</option>
                            <option value="SNX">Synthetix (SNX)</option>
                            <option value="1INCH">1inch (1INCH)</option>
                            <option value="LDO">Lido DAO (LDO)</option>
                            <option value="RNDR">Render (RNDR)</option>
                            <option value="STX">Stacks (STX)</option>
                            <option value="IMX">Immutable (IMX)</option>
                            <option value="FLOW">Flow (FLOW)</option>
                            <option value="GALA">Gala (GALA)</option>
                            <option value="APE">ApeCoin (APE)</option>
                            <option value="EGLD">MultiversX (EGLD)</option>
                            <option value="KAVA">Kava (KAVA)</option>
                            <option value="ZEC">Zcash (ZEC)</option>
                            <option value="DASH">Dash (DASH)</option>
                            <option value="NEO">NEO</option>
                            <option value="IOTA">IOTA</option>
                            <option value="QTUM">Qtum (QTUM)</option>
                            <option value="WAVES">Waves (WAVES)</option>
                            <option value="ZIL">Zilliqa (ZIL)</option>
                            <option value="ENJ">Enjin Coin (ENJ)</option>
                            <option value="BAT">Basic Attention Token (BAT)</option>
                            <option value="LRC">Loopring (LRC)</option>
                            <option value="ANKR">Ankr (ANKR)</option>
                            <option value="RVN">Ravencoin (RVN)</option>
                            <option value="HOT">Holo (HOT)</option>
                            <option value="OMG">OMG Network (OMG)</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>Выберите сеть</label>
                        <select id="deposit-network" onchange="updateWalletAddress()">
                            <option value="BTC">Bitcoin Network</option>
                            <option value="ETH">Ethereum (ERC-20)</option>
                            <option value="BSC">BNB Chain (BEP-20)</option>
                            <option value="TRON">Tron (TRC-20)</option>
                            <option value="SOL">Solana</option>
                            <option value="ADA">Cardano</option>
                            <option value="AVAX">Avalanche C-Chain</option>
                            <option value="MATIC">Polygon</option>
                            <option value="DOT">Polkadot</option>
                            <option value="ALGO">Algorand</option>
                            <option value="NEAR">NEAR</option>
                            <option value="APT">Aptos</option>
                            <option value="ARB">Arbitrum</option>
                            <option value="OP">Optimism</option>
                            <option value="SUI">Sui</option>
                            <option value="XTZ">Tezos</option>
                            <option value="EOS">EOS</option>
                            <option value="HBAR">Hedera</option>
                            <option value="XMR">Monero</option>
                            <option value="KSM">Kusama</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>Адрес для пополнения</label>
                        <div class="wallet-address" id="wallet-address">Выберите сеть</div>
                    </div>
                    <div class="input-group">
                        <label>Сумма</label>
                        <input type="number" id="deposit-amount-page" placeholder="Введите сумму">
                    </div>
                    <button class="btn btn-primary" onclick="depositFunds()">Пополнить</button>
                </div>
            </div>
        </div>
    </div>
    <div id="portfolio" class="main-content">
        <h2>Ваш портфель</h2>
        <div class="portfolio-grid" id="portfolio-grid"></div>
    </div>
    <div id="history" class="main-content">
        <div class="card">
            <h2>История транзакций</h2>
            <table class="transactions-table">
                <thead>
                    <tr>
                        <th>Дата</th>
                        <th>Тип</th>
                        <th>Криптовалюта</th>
                        <th>Количество</th>
                        <th>Цена</th>
                        <th>Сумма</th>
                        <th>Статус</th>
                        <th>P&L</th>
                    </tr>
                </thead>
                <tbody id="transactions-tbody"></tbody>
            </table>
        </div>
    </div>
    <button class="support-button" title="Поддержка" onclick="toggleSupportChat()">💬</button>
    <div class="support-chat" id="support-chat">
        <div class="chat-header">
            <h3>Поддержка TrustBit</h3>
            <button class="chat-close" onclick="toggleSupportChat()">✩</button>
        </div>
        <div class="chat-body" id="chat-body">
            <div class="chat-message support">Добро пожаловать! Как могу помочь?</div>
        </div>
        <div class="chat-input">
            <input type="text" id="chat-input" placeholder="Введите сообщение...">
            <button onclick="sendMessage()">Отправить</button>
        </div>
    </div>
    <footer class="footer">
        <p>© 2025 TrustBit. Все права защищены. Торговля криптовалютами сопряжена с высоким риском. Пожалуйста, торгуйте ответственно.</p>
        <p><a href="#">Условия использования</a> | <a href="#">Политика конфиденциальности</a> | <a href="#">Раскрытие рисков</a></p>
    </footer>
    <script>
        let balance = 1000;
        let portfolio = {};
        let transactions = [];
        let cryptoPrices = {
            BTC: 0, ETH: 0, USDT: 0, BNB: 0, LTC: 0, TON: 0, XRP: 0, SOL: 0, USDC: 0, DOGE: 0,
            TRX: 0, ADA: 0, WBTC: 0, AVAX: 0, SHIB: 0, LINK: 0, DOT: 0, MATIC: 0, BCH: 0, UNI: 0,
            XLM: 0, VET: 0, ATOM: 0, FIL: 0, ALGO: 0, NEAR: 0, ICP: 0, APT: 0, ARB: 0, OP: 0,
            INJ: 0, SUI: 0, XTZ: 0, EOS: 0, HBAR: 0, XMR: 0, KSM: 0, AAVE: 0, MKR: 0, GRT: 0,
            RUNE: 0, FTM: 0, SAND: 0, MANA: 0, AXS: 0, CHZ: 0, CRV: 0, COMP: 0, SNX: 0, '1INCH': 0,
            LDO: 0, RNDR: 0, STX: 0, IMX: 0, FLOW: 0, GALA: 0, APE: 0, EGLD: 0, KAVA: 0, ZEC: 0,
            DASH: 0, NEO: 0, IOTA: 0, QTUM: 0, WAVES: 0, ZIL: 0, ENJ: 0, BAT: 0, LRC: 0, ANKR: 0,
            RVN: 0, HOT: 0, OMG: 0
        };
        let cryptoPriceHistory = Object.fromEntries(Object.keys(cryptoPrices).map(c => [c, []]));
        let priceChanges = Object.fromEntries(Object.keys(cryptoPrices).map(c => [c, 0]));
        let previousPrices = { ...cryptoPrices };
        let selectedCrypto = 'BTC';
        let tradeMode = 'buy';
        let chart = null;
        let candlestickSeries = null;
        let currentTimeframe = '1d';
        const cryptoIdMap = {
            BTC: 'bitcoin', ETH: 'ethereum', USDT: 'tether', BNB: 'binancecoin', LTC: 'litecoin',
            TON: 'the-open-network', XRP: 'ripple', SOL: 'solana', USDC: 'usd-coin', DOGE: 'dogecoin',
            TRX: 'tron', ADA: 'cardano', WBTC: 'wrapped-bitcoin', AVAX: 'avalanche-2', SHIB: 'shiba-inu',
            LINK: 'chainlink', DOT: 'polkadot', MATIC: 'matic-network', BCH: 'bitcoin-cash',
            UNI: 'uniswap', XLM: 'stellar', VET: 'vechain', ATOM: 'cosmos', FIL: 'filecoin',
            ALGO: 'algorand', NEAR: 'near', ICP: 'internet-computer', APT: 'aptos',
            ARB: 'arbitrum', OP: 'optimism', INJ: 'injective-protocol', SUI: 'sui',
            XTZ: 'tezos', EOS: 'eos', HBAR: 'hedera-hashgraph', XMR: 'monero',
            KSM: 'kusama', AAVE: 'aave', MKR: 'maker', GRT: 'the-graph', RUNE: 'thorchain',
            FTM: 'fantom', SAND: 'the-sandbox', MANA: 'decentraland', AXS: 'axie-identity',
            CHZ: 'chiliz', CRV: 'curve-dao-token', COMP: 'compound-governance-token',
            SNX: 'havven', '1INCH': '1inch', LDO: 'lido-dao', RNDR: 'render-token',
            STX: 'blockstack', IMX: 'immutable-x', FLOW: 'flow', GALA: 'gala',
            APE: 'apecoin', EGLD: 'elrond-erd-2', KAVA: 'kava', ZEC: 'zcash',
            DASH: 'dash', NEO: 'neo', IOTA: 'iota', QTUM: 'qtum', WAVES: 'waves',
            ZIL: 'zilliqa', ENJ: 'enjin-coin', BAT: 'basic-attention-token',
            LRC: 'loopring', ANKR: 'ankr', RVN: 'ravencoin', HOT: 'holotoken',
            OMG: 'omisego'
        };
        const cryptoSymbols = {
            BTC: '₿', ETH: 'Ξ', USDT: '₮', BNB: 'B', LTC: 'Ł', TON: '$', XRP: 'Ʀ', SOL: '◎',
            USDC: '₡', DOGE: 'Ð', TRX: '₮', ADA: '₳', WBTC: '₿', AVAX: 'Ⓐ', SHIB: '柴',
            LINK: '🔗', DOT: '⚫', MATIC: '⬣', BCH: '₿', UNI: '🦄', XLM: '✦', VET: 'V',
            ATOM: '⚛', FIL: '📁', ALGO: 'Ⓐ', NEAR: 'Ⓝ', ICP: '🧠', APT: 'ⓐ', ARB: 'Ⓐ',
            OP: 'Ⓞ', INJ: '💉', SUI: 'Ⓢ', XTZ: 'ꜩ', EOS: 'ⓔ', HBAR: 'ℏ', XMR: 'ɱ',
            KSM: 'Ⓚ', AAVE: 'Ⓐ', MKR: 'Ⓜ', GRT: '📈', RUNE: 'ᚱ', FTM: '👻',
            SAND: '🏖', MANA: 'Ⓜ', AXS: '🪓', CHZ: '⚽', CRV: 'Ⓒ', COMP: 'Ⓒ',
            SNX: 'Ⓢ', '1INCH': '1"', LDO: 'Ⓛ', RNDR: '🎨', STX: 'Ⓢ', IMX: 'Ⓘ',
            FLOW: '🌊', GALA: '🎮', APE: '🦍', EGLD: 'Ⓔ', KAVA: '☕', ZEC: 'Ⓩ',
            DASH: 'ⓓ', NEO: 'Ⓝ', IOTA: 'ⓘ', QTUM: 'Ⓠ', WAVES: '🌊', ZIL: 'Ⓩ',
            ENJ: 'Ⓔ', BAT: '🦇', LRC: 'Ⓛ', ANKR: '⚓', RVN: 'Ⓡ', HOT: '🔥',
            OMG: '🕉'
        };

        function showSection(sectionId) {
            document.querySelectorAll('.main-content').forEach(section => section.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');
            document.querySelectorAll('.nav a').forEach(link => link.classList.remove('active'));
            document.querySelector(`.nav a[onclick="showSection('${sectionId}')"]`).classList.add('active');
            if (sectionId === 'trading') updateChart();
        }

        function renderCryptoList() {
    const cryptoItems = document.getElementById('crypto-items');
    if (!cryptoItems) {
        console.error('Crypto items container not found');
        return;
    }
    cryptoItems.innerHTML = '';
    const colorMap = {
        BTC: { start: 'f7931a', end: 'ffb74d' }, ETH: { start: '627eea', end: '8e44ad' },
        USDT: { start: '26a17b', end: '5ac8a8' }, BNB: { start: 'f3ba2f', end: 'f7de8a' },
        LTC: { start: 'b5b5b5', end: 'd9d9d9' }, TON: { start: '0088cc', end: '00b7eb' },
        XRP: { start: '222222', end: '555555' }, SOL: { start: '00ffa3', end: 'dc1fff' },
        USDC: { start: '2775ca', end: '5a9bd4' }, DOGE: { start: 'c3a634', end: 'e6c44f' },
        TRX: { start: 'eb0029', end: 'ff4d4d' }, ADA: { start: '3c84b9', end: '60a5fa' },
        WBTC: { start: 'f7931a', end: 'ffb74d' }, AVAX: { start: 'e84142', end: 'ff6b6b' }, // Исправлен 'ff6b' на 'ff6b6b'
        SHIB: { start: 'ff4500', end: 'ff8c00' }, LINK: { start: '2a5ada', end: '5a9bd4' },
        DOT: { start: 'e6007a', end: 'ff4d8c' }, MATIC: { start: '8247e5', end: 'a78bfa' },
        BCH: { start: '8dc351', end: 'b3e67a' }, UNI: { start: 'ff007a', end: 'ff4d8c' },
        XLM: { start: '000000', end: '333333' }, VET: { start: '15bffd', end: '4ddbff' },
        ATOM: { start: '2e3148', end: '4a5d78' }, FIL: { start: '0090ff', end: '4dc3ff' },
        ALGO: { start: '000000', end: '333333' }, NEAR: { start: '00e3ae', end: '4dffcd' },
        ICP: { start: 'd81f26', end: 'ff4d4d' }, APT: { start: '17e6b9', end: '4dffd4' },
        ARB: { start: '2a3b5a', end: '5a7aa8' }, OP: { start: 'ff0420', end: 'ff4d4d' },
        INJ: { start: '1e4dd8', end: '4d8bff' }, SUI: { start: '1a8cff', end: '4db3ff' },
        XTZ: { start: '2c7df7', end: '5aa8ff' }, EOS: { start: '000000', end: '333333' },
        HBAR: { start: '000000', end: '333333' }, XMR: { start: 'ff6600', end: 'ff9933' },
        KSM: { start: '000000', end: '333333' }, AAVE: { start: 'b6509e', end: 'e68bc5' },
        MKR: { start: '1aab9b', end: '4dd4b3' }, GRT: { start: '6747ed', end: '8b6bff' },
        RUNE: { start: '00d18b', end: '4dffa8' }, FTM: { start: '1969ff', end: '4d8bff' },
        SAND: { start: '00aeef', end: '4ddbff' }, MANA: { start: 'ff2a44', end: 'ff6b7a' }, // Исправлена синтаксическая ошибка (удалены лишние кавычки)
        AXS: { start: '0085d2', end: '4db3ff' }, CHZ: { start: 'e30013', end: 'ff4d4d' },
        CRV: { start: '4066e0', end: '6b8bff' }, COMP: { start: '00d395', end: '4dffa8' },
        SNX: { start: '00d1ff', end: '4dffff' }, '1INCH': { start: '1f3b5b', end: '4d7aa8' },
        LDO: { start: '00a3ff', end: '4ddbff' }, RNDR: { start: 'ff3c3c', end: 'ff7a7a' },
        STX: { start: '5548de', end: '7a6bff' }, IMX: { start: '00c4b4', end: '4dffcd' },
        FLOW: { start: '00ef8b', end: '4dffa8' }, GALA: { start: '000000', end: '333333' },
        APE: { start: '0033cc', end: '4d7aff' }, EGLD: { start: '0d0221', end: '333366' },
        KAVA: { start: 'ff4338', end: 'ff7a7a' }, ZEC: { start: 'f4b728', end: 'ffd966' },
        DASH: { start: '008ce7', end: '4db3ff' }, NEO: { start: '58bf00', end: '8bff4d' },
        IOTA: { start: '000000', end: '333333' }, QTUM: { start: '2e9dfd', end: '6bb8ff' },
        WAVES: { start: '0153ff', end: '4d8bff' }, ZIL: { start: '49a49b', end: '7ad4b3' },
        ENJ: { start: '624de4', end: '8b6bff' }, BAT: { start: 'ff5000', end: 'ff8c4d' },
        LRC: { start: '2ab6f6', end: '6bd4ff' }, ANKR: { start: '1e4dd8', end: '4d8bff' },
        RVN: { start: '3848a0', end: '6b7aa8' }, HOT: { start: 'ff3c3c', end: 'ff7a7a' },
        OMG: { start: '1a1a1a', end: '4d4d4d' },
        default: { start: '7e6bff', end: '5a4bff' }
    };
    Object.keys(cryptoPrices).forEach(crypto => {
        const colors = colorMap[crypto] || colorMap.default;
        const item = document.createElement('div');
        item.className = 'crypto-item';
        item.onclick = () => selectCrypto(crypto);
        const name = cryptoIdMap[crypto] ? cryptoIdMap[crypto].replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase()) : crypto;
        item.innerHTML = `
            <div class="crypto-info">
                <div class="crypto-icon" style="background: linear-gradient(45deg, #${colors.start}, #${colors.end});">${cryptoSymbols[crypto] || crypto.charAt(0)}</div>
                <div>
                    <div>${name}</div>
                    <div style="font-size: 12px; opacity: 0.7;">${crypto}</div>
                </div>
            </div>
            <div class="crypto-price">
                <div class="price">$<span id="${crypto.toLowerCase()}-price">0</span></div>
                <div class="change" id="${crypto.toLowerCase()}-change">0%</div>
            </div>
        `;
        cryptoItems.appendChild(item);
    });
}

document.querySelector('.profile-btn').addEventListener('click', () => {
    const dropdown = document.querySelector('.dropdown-menu');
    if (dropdown) {
        dropdown.classList.toggle('active');
    } else {
        console.error('Dropdown menu not found');
    }
});

function setTradeMode(mode) {
    tradeMode = mode;
    const tabs = document.querySelectorAll('.tab');
    tabs.forEach(tab => tab.classList.remove('active'));
    const activeTab = document.querySelector(`.tab[onclick="setTradeMode('${mode}')"]`);
    if (activeTab) {
        activeTab.classList.add('active');
    } else {
        console.error(`Tab for mode '${mode}' not found`);
    }
    const tradeBtn = document.getElementById('trade-btn');
    if (tradeBtn) {
        tradeBtn.textContent = mode === 'buy' ? 'Купить' : 'Продать';
    } else {
        console.error('Trade button not found');
    }
}

function selectCrypto(crypto) {
    selectedCrypto = crypto; // Исправлена синтаксическая ошибка (удалено 'crypto' перед переменной)
    const selectedCryptoEl = document.getElementById('selected-crypto');
    const chartCryptoEl = document.getElementById('chart-crypto');
    if (selectedCryptoEl && chartCryptoEl) {
        selectedCryptoEl.textContent = crypto;
        chartCryptoEl.textContent = crypto;
        updateChart();
        updateOrderBook();
    } else {
        console.error('Selected crypto or chart crypto element not found');
    }
}

function setTimeframe(timeframe) {
    currentTimeframe = timeframe;
    const timeframeButtons = document.querySelectorAll('.timeframe-btn');
    timeframeButtons.forEach(btn => btn.classList.remove('active'));
    const activeBtn = document.querySelector(`.timeframe-btn[onclick="setTimeframe('${timeframe}')"]`);
    if (activeBtn) {
        activeBtn.classList.add('active');
        updateChart();
    } else {
        console.error(`Timeframe button for '${timeframe}' not found`);
    }
}
        function updateWalletAddress() {
            const network = document.getElementById('deposit-network').value;
            const crypto = document.getElementById('deposit-crypto').value;
            const addressPrefix = {
                BTC: 'bc1', ETH: '0x', BSC: '0x', TRON: 'T', SOL: 'sol', ADA: 'addr',
                AVAX: 'avax', MATIC: '0x', DOT: '1', ALGO: 'algo', NEAR: 'near',
                APT: 'apt', ARB: '0x', OP: '0x', SUI: 'sui', XTZ: 'tz',
                EOS: 'eos', HBAR: 'hbar', XMR: '4x', KSM: 'ksm'
            };
            const randomId = Math.random().toString(16).slice(2, 34);
            const address = `${addressPrefix[network] || '0x'}${randomId}`;
            document.getElementById('wallet-address').textContent = address;
        }

        async function fetchCryptoPrices() {
        try {
            const coins = Object.values(cryptoIdMap);
            const batchSize = 30;
            for (let i = 0; i < coins.length; i += batchSize) {
                const batch = coins.slice(i, i + batchSize).join(',');
                const response = await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${batch}&vs_currencies=usd&include_24hr_change=true`);
                if (!response.ok) throw new Error(`HTTP error: ${response.status}`);
                const data = await response.json();
                Object.keys(cryptoIdMap).forEach(symbol => {
                    const id = cryptoIdMap[symbol];
                    if (data[id]) {
                        previousPrices[symbol] = cryptoPrices[symbol];
                        cryptoPrices[symbol] = parseFloat(data[id].usd);
                        priceChanges[symbol] = parseFloat(data[id].usd_24h_change).toFixed(2);
                        cryptoPriceHistory[symbol].push({ time: Math.floor(Date.now() / 1000), value: cryptoPrices[symbol] });
                        if (cryptoPriceHistory[symbol].length > 50) cryptoPriceHistory[symbol].shift();
                    }
                });
            }
            updateCryptoList();
            updatePortfolio();
            if (document.getElementById('trading').classList.contains('active')) updateLiveCandle();
        } catch (error) {
            console.error('Error fetching prices:', error.message);
            Object.keys(cryptoPrices).forEach(symbol => {
                if (cryptoPrices[symbol] === 0) {
                    cryptoPrices[symbol] = Math.random() * 10000 + 1000;
                    priceChanges[symbol] = ((Math.random() - 0.5) * 10).toFixed(2);
                    cryptoPriceHistory[symbol].push({ time: Math.floor(Date.now() / 1000), value: cryptoPrices[symbol] });
                    if (cryptoPriceHistory[symbol].length > 50) cryptoPriceHistory[symbol].shift();
                }
            });
            updateCryptoList();
            updatePortfolio();
        }
    }

    async function fetchNews() {
        try {
            const apiKey = 'cee5353296df40ec9a461b683083e5c2';
            const response = await fetch(`https://newsapi.org/v2/everything?q=cryptocurrency&language=ru&sortBy=publishedAt&apiKey=${apiKey}`);
            if (!response.ok) throw new Error(`HTTP error: ${response.status}`);
            const data = await response.json();
            if (data.status === 'error') throw new Error(`NewsAPI error: ${data.message}`);
            const newsList = document.getElementById('news-list');
            newsList.innerHTML = '';
            data.articles.slice(0, 5).forEach(article => {
                const item = document.createElement('div');
                item.className = 'news-item';
                item.innerHTML = `
                    <div class="news-content">
                        <h3>${article.title}</h3>
                        <p>${article.description || 'Подробности отсутствуют'}</p>
                        <div class="source">${article.source.name}</div>
                    </div>
                `;
                newsList.appendChild(item);
            });
        } catch (error) {
            console.error('Error fetching news:', error.message);
            const newsList = document.getElementById('news-list');
            newsList.innerHTML = '';
            const mockNews = [
                { title: "Bitcoin достигает нового максимума", description: "Крупнейшая криптовалюта продолжает ралли.", source: "CoinDesk" },
                { title: "Ethereum готовится к обновлению", description: "Новое обновление снизит комиссии.", source: "The Block" },
                { title: "Tether укрепляет позиции", description: "USDT остается лидером.", source: "CryptoSlate" },
                { title: "Binance Coin растет", description: "BNB показывает рост.", source: "CoinTelegraph" }
            ];
            mockNews.forEach(news => {
                const item = document.createElement('div');
                item.className = 'news-item';
                item.innerHTML = `
                    <div class="news-content">
                        <h3>${news.title}</h3>
                        <p>${news.description}</p>
                        <div class="source">${news.source}</div>
                    </div>
                `;
                newsList.appendChild(item);
            });
        }
    }

    function updateCryptoList() {
        Object.keys(cryptoPrices).forEach(crypto => {
            const priceElement = document.getElementById(`${crypto.toLowerCase()}-price`);
            const changeElement = document.getElementById(`${crypto.toLowerCase()}-change`);
            if (priceElement && changeElement) {
                priceElement.textContent = cryptoPrices[crypto].toFixed(2);
                changeElement.textContent = `${priceChanges[crypto]}%`;
                changeElement.className = `change ${priceChanges[crypto] >= 0 ? 'positive' : 'negative'}`;
            }
        });
    }

    function updateOrderBook() {
        const bidsTbody = document.getElementById('order-book-bids');
        const asksTbody = document.getElementById('order-book-asks');
        bidsTbody.innerHTML = '';
        asksTbody.innerHTML = '';
        const price = cryptoPrices[selectedCrypto] || 1000;
        for (let i = 5; i >= 1; i--) {
            const bidPrice = (price * (1 - i * 0.001)).toFixed(2);
            const askPrice = (price * (1 + i * 0.001)).toFixed(2);
            const bidAmount = (Math.random() * 10).toFixed(4);
            const askAmount = (Math.random() * 10).toFixed(4);
            bidsTbody.innerHTML += `<tr class="buy"><td>${bidPrice}</td><td>${bidAmount}</td></tr>`;
            asksTbody.innerHTML += `<tr class="sell"><td>${askPrice}</td><td>${askAmount}</td></tr>`;
        }
    }

    function depositFunds() {
        const amount = parseFloat(document.getElementById('deposit-amount-page').value);
        const crypto = document.getElementById('deposit-crypto').value;
        if (amount > 0 && cryptoPrices[crypto] > 0) {
            balance += amount;
            portfolio[crypto] = (portfolio[crypto] || 0) + (amount / cryptoPrices[crypto]);
            document.getElementById('wallet-balance-page').textContent = balance.toFixed(2);
            transactions.push({
                date: new Date().toLocaleString(),
                type: 'Пополнение',
                crypto,
                amount: (amount / cryptoPrices[crypto]).toFixed(6),
                price: `$${cryptoPrices[crypto].toFixed(2)}`,
                total: `$${amount.toFixed(2)}`,
                status: 'Успешно',
                pl: `+$${amount.toFixed(2)}`
            });
            updateTransactions();
            updatePortfolio();
            document.getElementById('deposit-amount-page').value = '';
        } else {
            alert('Введите корректную сумму или дождитесь загрузки цен');
        }
    }

    function executeTrade() {
        const amount = parseFloat(document.getElementById('trade-amount').value);
        const cryptoAmount = parseFloat(document.getElementById('crypto-amount').value);
        if (amount <= 0 || isNaN(amount) || cryptoAmount <= 0 || isNaN(cryptoAmount) || !cryptoPrices[selectedCrypto]) {
            alert('Введите корректную сумму или дождитесь загрузки цен');
            return;
        }
        if (tradeMode === 'buy') {
            if (amount <= balance) {
                balance -= amount;
                portfolio[selectedCrypto] = (portfolio[selectedCrypto] || 0) + cryptoAmount;
                transactions.push({
                    date: new Date().toLocaleString(),
                    type: 'Покупка',
                    crypto: selectedCrypto,
                    amount: cryptoAmount.toFixed(6),
                    price: `$${cryptoPrices[selectedCrypto].toFixed(2)}`,
                    total: `$${amount.toFixed(2)}`,
                    status: 'Успешно',
                    pl: '-'
                });
            } else {
                alert('Недостаточно средств');
                transactions.push({
                    date: new Date().toLocaleString(),
                    type: 'Покупка',
                    crypto: selectedCrypto,
                    amount: cryptoAmount.toFixed(6),
                    price: `$${cryptoPrices[selectedCrypto].toFixed(2)}`,
                    total: `$${amount.toFixed(2)}`,
                    status: 'Неудача',
                    pl: '-'
                });
            }
        } else {
            if (portfolio[selectedCrypto] && portfolio[selectedCrypto] >= cryptoAmount) {
                balance += amount;
                portfolio[selectedCrypto] -= cryptoAmount;
                if (portfolio[selectedCrypto] === 0) delete portfolio[selectedCrypto];
                transactions.push({
                    date: new Date().toLocaleString(),
                    type: 'Продажа',
                    crypto: selectedCrypto,
                    amount: cryptoAmount.toFixed(6),
                    price: `$${cryptoPrices[selectedCrypto].toFixed(2)}`,
                    total: `$${amount.toFixed(2)}`,
                    status: 'Успешно',
                    pl: '-'
                });
            } else {
                alert('Недостаточно криптовалюты');
                transactions.push({
                    date: new Date().toLocaleString(),
                    type: 'Продажа',
                    crypto: selectedCrypto,
                    amount: cryptoAmount.toFixed(6),
                    price: `$${cryptoPrices[selectedCrypto].toFixed(2)}`,
                    total: `$${amount.toFixed(2)}`,
                    status: 'Неудача',
                    pl: '-'
                });
            }
        }
        document.getElementById('wallet-balance-page').textContent = balance.toFixed(2);
        updatePortfolio();
        updateTransactions();
        document.getElementById('trade-amount').value = '';
        document.getElementById('crypto-amount').value = '';
    }

    function updatePortfolio() {
        const portfolioGrid = document.getElementById('portfolio-grid');
        portfolioGrid.innerHTML = '';
        const colorMap = {
            BTC: { start: 'f7931a', end: 'ffb74d' }, ETH: { start: '627eea', end: '8e44ad' },
            USDT: { start: '26a17b', end: '5ac8a8' }, BNB: { start: 'f3ba2f', end: 'f7de8a' },
            LTC: { start: 'b5b5b5', end: 'd9d9d9' }, TON: { start: '0088cc', end: '00b7eb' },
            XRP: { start: '222222', end: '555555' }, SOL: { start: '00ffa3', end: 'dc1fff' },
            USDC: { start: '2775ca', end: '5a9bd4' }, DOGE: { start: 'c3a634', end: 'e6c44f' },
            TRX: { start: 'eb0029', end: 'ff4d4d' }, ADA: { start: '3c84b9', end: '60a5fa' },
            WBTC: { start: 'f7931a', end: 'ffb74d' }, AVAX: { start: 'e84142', end: 'ff6b6b' },
            SHIB: { start: 'ff4500', end: 'ff8c00' }, LINK: { start: '2a5ada', end: '5a9bd4' },
            DOT: { start: 'e6007a', end: 'ff4d8c' }, MATIC: { start: '8247e5', end: 'a78bfa' },
            BCH: { start: '8dc351', end: 'b3e67a' }, UNI: { start: 'ff007a', end: 'ff4d8c' },
            XLM: { start: '000000', end: '333333' }, VET: { start: '15bffd', end: '4ddbff' },
            ATOM: { start: '2e3148', end: '4a5d78' }, FIL: { start: '0090ff', end: '4dc3ff' },
            ALGO: { start: '000000', end: '333333' }, NEAR: { start: '00e3ae', end: '4dffcd' },
            ICP: { start: 'd81f26', end: 'ff4d4d' }, APT: { start: '17e6b9', end: '4dffd4' },
            ARB: { start: '2a3b5a', end: '5a7aa8' }, OP: { start: 'ff0420', end: 'ff4d4d' },
            INJ: { start: '1e4dd8', end: '4d8bff' }, SUI: { start: '1a8cff', end: '4db3ff' },
            XTZ: { start: '2c7df7', end: '5aa8ff' }, EOS: { start: '000000', end: '333333' },
            HBAR: { start: '000000', end: '333333' }, XMR: { start: 'ff6600', end: 'ff9933' },
            KSM: { start: '000000', end: '333333' }, AAVE: { start: 'b6509e', end: 'e68bc5' },
            MKR: { start: '1aab9b', end: '4dd4b3' }, GRT: { start: '6747ed', end: '8b6bff' },
            RUNE: { start: '00d18b', end: '4dffa8' }, FTM: { start: '1969ff', end: '4d8bff' },
            SAND: { start: '00aeef', end: '4ddbff' }, MANA: { start: 'ff2a44', end: 'ff6b7a' },
            AXS: { start: '0085d2', end: '4db3ff' }, CHZ: { start: 'e30013', end: 'ff4d4d' },
            CRV: { start: '4066e0', end: '6b8bff' }, COMP: { start: '00d395', end: '4dffa8' },
            SNX: { start: '00d1ff', end: '4dffff' }, '1INCH': { start: '1f3b5b', end: '4d7aa8' },
            LDO: { start: '00a3ff', end: '4ddbff' }, RNDR: { start: 'ff3c3c', end: 'ff7a7a' },
            STX: { start: '5548de', end: '7a6bff' }, IMX: { start: '00c4b4', end: '4dffcd' },
            FLOW: { start: '00ef8b', end: '4dffa8' }, GALA: { start: '000000', end: '333333' },
            APE: { start: '0033cc', end: '4d7aff' }, EGLD: { start: '0d0221', end: '333366' },
            KAVA: { start: 'ff4338', end: 'ff7a7a' }, ZEC: { start: 'f4b728', end: 'ffd966' },
            DASH: { start: '008ce7', end: '4db3ff' }, NEO: { start: '58bf00', end: '8bff4d' },
            IOTA: { start: '000000', end: '333333' }, QTUM: { start: '2e9dfd', end: '6bb8ff' },
            WAVES: { start: '0153ff', end: '4d8bff' }, ZIL: { start: '49a49b', end: '7ad4b3' },
            ENJ: { start: '624de4', end: '8b6bff' }, BAT: { start: 'ff5000', end: 'ff8c4d' },
            LRC: { start: '2ab6f6', end: '6bd4ff' }, ANKR: { start: '1e4dd8', end: '4d8bff' },
            RVN: { start: '3848a0', end: '6b7aa8' }, HOT: { start: 'ff3c3c', end: 'ff7a7a' },
            OMG: { start: '1a1a1a', end: '4d4d4d' }
        };
        Object.keys(cryptoPrices).forEach(crypto => {
            if (portfolio[crypto] && cryptoPrices[crypto]) {
                const value = (portfolio[crypto] * cryptoPrices[crypto]).toFixed(2);
                const item = document.createElement('div');
                item.className = 'portfolio-item';
                item.innerHTML = `
                    <div class="crypto-icon" style="background: linear-gradient(45deg, #${colorMap[crypto].start}, #${colorMap[crypto].end})">${crypto.charAt(0)}</div>
                    <div class="portfolio-amount">${portfolio[crypto].toFixed(6)} ${crypto}</div>
                    <div class="portfolio-value">$${value}</div>
                `;
                portfolioGrid.appendChild(item);
            }
        });
    }

    function updateTransactions() {
        const tbody = document.getElementById('transactions-tbody');
        tbody.innerHTML = '';
        transactions.forEach(tx => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${tx.date}</td>
                <td>${tx.type}</td>
                <td>${tx.crypto}</td>
                <td>${tx.amount}</td>
                <td>${tx.price}</td>
                <td>${tx.total}</td>
                <td><span class="status ${tx.status === 'Успешно' ? 'success' : 'failed'}">${tx.status}</span></td>
                <td>${tx.pl}</td>
            `;
            tbody.appendChild(row);
        });
    }

    document.getElementById('trade-amount').addEventListener('input', () => {
        const amount = parseFloat(document.getElementById('trade-amount').value);
        if (!isNaN(amount) && amount > 0 && cryptoPrices[selectedCrypto] > 0) {
            const cryptoAmount = amount / cryptoPrices[selectedCrypto];
            document.getElementById('crypto-amount').value = cryptoAmount.toFixed(6);
        } else {
            document.getElementById('crypto-amount').value = '';
        }
    });

    function toggleSupportChat() {
        const chat = document.getElementById('support-chat');
        chat.classList.toggle('active');
    }

    function sendMessage() {
        const input = document.getElementById('chat-input');
        const messageText = input.value.trim();
        if (messageText) {
            const chatBody = document.getElementById('chat-body');
            const userMessage = document.createElement('div');
            userMessage.className = 'chat-message user';
            userMessage.textContent = messageText;
            chatBody.appendChild(userMessage);
            chatBody.scrollTop = chatBody.scrollHeight;
            input.value = '';
            setTimeout(() => {
                const supportMessage = document.createElement('div');
                supportMessage.className = 'chat-message support';
                supportMessage.textContent = getSupportResponse(messageText);
                chatBody.appendChild(supportMessage);
                chatBody.scrollTop = chatBody.scrollHeight;
            }, 1000);
        }
    }

    function getSupportResponse(message) {
        const lowerMessage = message.toLowerCase();
        if (lowerMessage.includes('пополнить') || lowerMessage.includes('deposit')) {
            return 'Чтобы пополнить кошелек, перейдите в раздел "Кошелек", выберите криптовалюту и сеть, затем следуйте инструкциям.';
        } else if (lowerMessage.includes('торгов') || lowerMessage.includes('купить') || lowerMessage.includes('продать')) {
            return 'Для торговли перейдите в раздел "Торговля", выберите криптовалюту, укажите сумму и нажмите "Купить" или "Продать".';
        } else if (lowerMessage.includes('пароль') || lowerMessage.includes('вход')) {
            return 'Если вы забыли пароль, нажмите "Вход" и выберите "Восстановить пароль".';
        } else {
            return 'Пожалуйста, уточните ваш вопрос.';
        }
    }

    document.querySelector('.support-button').addEventListener('click', toggleSupportChat);
    document.querySelector('.chat-close').addEventListener('click', toggleSupportChat);
    document.getElementById('chat-input').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') sendMessage();
    });

    async function updateChart() {
        const chartContainer = document.getElementById('trading-chart');
        if (!chartContainer) {
            console.error('Chart container not found');
            return;
        }

        try {
            const timeframeDays = { '1h': 1, '4h': 7, '1d': 30 };
            const days = timeframeDays[currentTimeframe] || 30;
            const cryptoId = cryptoIdMap[selectedCrypto];
            const historicalData = await fetchHistoricalData(cryptoId, days);

            if (chart) {
                chart.remove();
                chart = null;
                candlestickSeries = null;
            }

            chart = LightweightCharts.createChart(chartContainer, {
                width: chartContainer.clientWidth,
                height: chartContainer.clientHeight,
                layout: {
                    background: { type: 'solid', color: '#1a1a2e' },
                    textColor: '#e6e6e6'
                },
                grid: {
                    vertLines: { color: 'rgba(255, 255, 255, 0.1)' },
                    horzLines: { color: 'rgba(255, 255, 255, 0.1)' }
                },
                rightPriceScale: { borderColor: 'rgba(255, 255, 255, 0.2)' },
                timeScale: { borderColor: 'rgba(255, 255, 255, 0.2)' },
                crosshair: { mode: LightweightCharts.CrosshairMode.Normal }
            });

            candlestickSeries = chart.addCandlestickSeries({
                upColor: '#43e97b',
                downColor: '#f5576c',
                borderUpColor: '#43e97b',
                borderDownColor: '#f5576c',
                wickUpColor: '#43e97b',
                wickDownColor: '#f5576c'
            });

            if (historicalData.length > 0) {
                candlestickSeries.setData(historicalData);
            } else {
                console.warn('No historical data, using mock');
                candlestickSeries.setData(generateMockOHLC(days));
            }

            chart.timeScale().fitContent();

            window.addEventListener('resize', () => {
                if (chart) chart.resize(chartContainer.clientWidth, chartContainer.clientHeight);
            });
        } catch (error) {
            console.error('Chart initialization error:', error.message);
            if (!chart) {
                chart = LightweightCharts.createChart(chartContainer, {
                    width: chartContainer.clientWidth,
                    height: chartContainer.clientHeight,
                    layout: {
                        background: { type: 'solid', color: '#1a1a2e' },
                        textColor: '#e6e6e6'
                    },
                    grid: {
                        vertLines: { color: 'rgba(255, 255, 255, 0.1)' },
                        horzLines: { color: 'rgba(255, 255, 255, 0.1)' }
                    },
                    rightPriceScale: { borderColor: 'rgba(255, 255, 255, 0.2)' },
                    timeScale: { borderColor: 'rgba(255, 255, 255, 0.2)' }
                });
                candlestickSeries = chart.addCandlestickSeries({
                    upColor: '#43e97b',
                    downColor: '#f5576c',
                    borderUpColor: '#43e97b',
                    borderDownColor: '#f5576c',
                    wickUpColor: '#43e97b',
                    wickDownColor: '#f5576c'
                });
                candlestickSeries.setData(generateMockOHLC(30));
                chart.timeScale().fitContent();
            }
        }
    }

    function updateLiveCandle() {
        if (!candlestickSeries || !document.getElementById('trading').classList.contains('active')) return;

        const price = cryptoPrices[selectedCrypto];
        if (!price) {
            console.warn('No price for', selectedCrypto);
            return;
        }

        const now = Math.floor(Date.now() / 1000);
        const interval = currentTimeframe === '1h' ? 3600 : currentTimeframe === '4h' ? 4 * 3600 : 24 * 3600;
        const candleTime = Math.floor(now / interval) * interval;

        const lastCandle = candlestickSeries.data().slice(-1)[0] || {
            time: candleTime,
            open: price,
            high: price,
            low: price,
            close: price
        };

        if (lastCandle.time !== candleTime) {
            candlestickSeries.update({
                time: candleTime,
                open: price,
                high: price,
                low: price,
                close: price
            });
        } else {
            candlestickSeries.update({
                time: candleTime,
                open: lastCandle.open,
                high: Math.max(lastCandle.high, price),
                low: Math.min(lastCandle.low, price),
                close: price
            });
        }
    }

    async function fetchHistoricalData(cryptoId, days) {
        try {
            const response = await fetch(`https://api.coingecko.com/api/v3/coins/${cryptoId}/ohlc?vs_currency=usd&days=${days}`);
            if (!response.ok) throw new Error(`HTTP error: ${response.status}`);
            const data = await response.json();
            return data.map(([time, open, high, low, close]) => ({
                time: time / 1000,
                open,
                high,
                low,
                close
            }));
        } catch (error) {
            console.error(`Failed to fetch historical data for ${cryptoId}:`, error.message);
            return [];
        }
    }

    function generateMockOHLC(days) {
        const data = [];
        const now = Math.floor(Date.now() / 1000);
        const interval = currentTimeframe === '1h' ? 3600 : currentTimeframe === '4h' ? 4 * 3600 : 24 * 3600;
        const periods = Math.floor((days * 24 * 3600) / interval);
        let price = cryptoPrices[selectedCrypto] || 10000;
        for (let i = periods; i >= 0; i--) {
            const time = now - i * interval;
            const open = price;
            const high = price * (1 + Math.random() * 0.02);
            const low = price * (1 - Math.random() * 0.02);
            const close = price + (Math.random() - 0.5) * 100;
            price = close;
            data.push({ time, open, high, low, close });
        }
        return data;
    }

    document.addEventListener('DOMContentLoaded', () => {
        if (typeof LightweightCharts === 'undefined') {
            console.error('Lightweight Charts library not loaded');
            return;
        }
        renderCryptoList();
        fetchCryptoPrices();
        fetchNews();
        updateWalletAddress();
        updateChart();
        setInterval(() => {
            fetchCryptoPrices();
            updateLiveCandle();
        }, 5000);
        setInterval(fetchNews, 600000);
    });
</script>
</body>
</html>
